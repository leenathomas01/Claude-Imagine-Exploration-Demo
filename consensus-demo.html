<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Consensus Demonstration Dashboard</title>
  <script crossorigin src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
  <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
  <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
  <style>
    body { font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', sans-serif; margin: 0; padding: 20px; background: #f5f5f5; }
    .dashboard { max-width: 1200px; margin: 0 auto; }
    .header { text-align: center; margin-bottom: 20px; }
    .agents { display: grid; grid-template-columns: repeat(3, 1fr); gap: 15px; margin-bottom: 20px; }
    .agent-card { background: white; border-radius: 8px; padding: 15px; box-shadow: 0 2px 4px rgba(0,0,0,0.1); }
    .agent-name { font-weight: bold; font-size: 18px; margin-bottom: 8px; }
    .agent-status { padding: 6px 12px; border-radius: 4px; font-size: 14px; display: inline-block; }
    .status-idle { background: #e0e0e0; color: #666; }
    .status-active { background: #fff3cd; color: #856404; }
    .status-success { background: #d4edda; color: #155724; }
    .status-waiting { background: #cce5ff; color: #004085; }
    .controls { text-align: center; margin-bottom: 20px; }
    .btn { background: #007bff; color: white; border: none; padding: 12px 24px; font-size: 16px; border-radius: 6px; cursor: pointer; }
    .btn:hover { background: #0056b3; }
    .btn:disabled { background: #ccc; cursor: not-allowed; }
    .message-log { background: white; border-radius: 8px; padding: 15px; box-shadow: 0 2px 4px rgba(0,0,0,0.1); margin-bottom: 20px; }
    .message-log h3 { margin-top: 0; }
    .log-list { max-height: 300px; overflow-y: auto; border: 1px solid #ddd; padding: 10px; border-radius: 4px; font-family: 'Courier New', monospace; font-size: 13px; }
    .log-entry { margin-bottom: 8px; }
    .log-tag { font-weight: bold; color: #007bff; }
    .policy-output { background: white; border-radius: 8px; padding: 15px; box-shadow: 0 2px 4px rgba(0,0,0,0.1); }
    .policy-output h3 { margin-top: 0; color: #28a745; }
    .policy-text { font-size: 16px; padding: 10px; background: #f8f9fa; border-left: 4px solid #28a745; }
  </style>
</head>
<body>
  <div id="root"></div>

  <script type="text/babel">
    const { useState } = React;

    function ConsensusDashboard() {
      const [agentStatuses, setAgentStatuses] = useState({
        coordinator: { status: 'Idle', color: 'idle' },
        dataAgent: { status: 'Idle', color: 'idle' },
        decisionAgent: { status: 'Idle', color: 'idle' }
      });
      const [messages, setMessages] = useState([]);
      const [policy, setPolicy] = useState('');
      const [running, setRunning] = useState(false);

      const simulationSteps = [
        {
          statuses: { coordinator: { status: 'Requesting Data', color: 'active' }, dataAgent: { status: 'Awaiting Request', color: 'waiting' }, decisionAgent: { status: 'Idle', color: 'idle' } },
          message: { tag: '[DAT-REQ]', text: 'Coordinator ‚Üí DataAgent: Request water usage statistics' }
        },
        {
          statuses: { coordinator: { status: 'Awaiting Data', color: 'waiting' }, dataAgent: { status: 'Processing Request', color: 'active' }, decisionAgent: { status: 'Idle', color: 'idle' } },
          message: { tag: '[DAT-RESP]', text: 'DataAgent ‚Üí Coordinator: Regional water usage +15% over past 3 months' }
        },
        {
          statuses: { coordinator: { status: 'Analyzing', color: 'active' }, dataAgent: { status: 'Complete', color: 'success' }, decisionAgent: { status: 'Awaiting Proposal', color: 'waiting' } },
          message: { tag: '[POL-PROP]', text: 'Coordinator ‚Üí DecisionAgent: Propose restriction to 2 days/week irrigation' }
        },
        {
          statuses: { coordinator: { status: 'Awaiting Feedback', color: 'waiting' }, dataAgent: { status: 'Complete', color: 'success' }, decisionAgent: { status: 'Evaluating', color: 'active' } },
          message: { tag: '[CRITIQUE]', text: 'DecisionAgent ‚Üí Coordinator: Restriction may harm agricultural sector' }
        },
        {
          statuses: { coordinator: { status: 'Awaiting Feedback', color: 'waiting' }, dataAgent: { status: 'Complete', color: 'success' }, decisionAgent: { status: 'Evaluating', color: 'active' } },
          message: { tag: '[DISAGREE]', text: 'DecisionAgent ‚Üí Coordinator: Need mitigation measures for farmers' }
        },
        {
          statuses: { coordinator: { status: 'Awaiting Feedback', color: 'waiting' }, dataAgent: { status: 'Complete', color: 'success' }, decisionAgent: { status: 'Proposing Alternative', color: 'active' } },
          message: { tag: '[SUGGEST_ALTERNATIVE]', text: 'DecisionAgent ‚Üí Coordinator: Add public awareness campaign component' }
        },
        {
          statuses: { coordinator: { status: 'Mediating', color: 'active' }, dataAgent: { status: 'Complete', color: 'success' }, decisionAgent: { status: 'Awaiting Response', color: 'waiting' } },
          message: { tag: '[MEDIATE]', text: 'Coordinator ‚Üí All: Pilot program approach - restrict irrigation + awareness campaign' }
        },
        {
          statuses: { coordinator: { status: 'Clarifying', color: 'active' }, dataAgent: { status: 'Complete', color: 'success' }, decisionAgent: { status: 'Awaiting Clarification', color: 'waiting' } },
          message: { tag: '[CLARIFY]', text: 'Coordinator ‚Üí DecisionAgent: Pilot duration 6 months with evaluation checkpoints' }
        },
        {
          statuses: { coordinator: { status: 'Awaiting Validation', color: 'waiting' }, dataAgent: { status: 'Validating', color: 'active' }, decisionAgent: { status: 'Reviewing', color: 'active' } },
          message: { tag: '[VALIDATE]', text: 'DataAgent ‚Üí Coordinator: Pilot approach aligns with conservation targets' }
        },
        {
          statuses: { coordinator: { status: 'Awaiting Validation', color: 'waiting' }, dataAgent: { status: 'Complete', color: 'success' }, decisionAgent: { status: 'Reviewing', color: 'active' } },
          message: { tag: '[VALIDATE]', text: 'DecisionAgent ‚Üí Coordinator: Balanced approach acceptable with awareness component' }
        },
        {
          statuses: { coordinator: { status: 'Consensus Reached', color: 'success' }, dataAgent: { status: 'Complete', color: 'success' }, decisionAgent: { status: 'Complete', color: 'success' } },
          message: { tag: '[CONS-AGREE]', text: 'All Agents ‚Üí Consensus: Policy approved for implementation' },
          policy: 'Policy: Pilot restrict irrigation to 2 days/week + public awareness campaign (6-month evaluation period)'
        }
      ];

      const runConsensusSimulation = async () => {
        setRunning(true);
        setMessages([]);
        setPolicy('');
        
        setAgentStatuses({
          coordinator: { status: 'Idle', color: 'idle' },
          dataAgent: { status: 'Idle', color: 'idle' },
          decisionAgent: { status: 'Idle', color: 'idle' }
        });

        for (let i = 0; i < simulationSteps.length; i++) {
          await new Promise(resolve => setTimeout(resolve, 800));
          
          const step = simulationSteps[i];
          
          setAgentStatuses(step.statuses);
          
          setMessages(prev => {
            const updated = [...prev, step.message];
            return updated.slice(-20);
          });
          
          if (step.policy) {
            setPolicy(step.policy);
          }
        }
        
        setRunning(false);
      };

      return (
        <div className="dashboard">
          <div className="header">
            <h1>ü§ù Consensus Demonstration Dashboard</h1>
            <p>Multi-Agent Policy Consensus Protocol Simulator</p>
          </div>

          <div className="agents">
            <div className="agent-card">
              <div className="agent-name">üéØ Coordinator</div>
              <span className={`agent-status status-${agentStatuses.coordinator.color}`}>
                {agentStatuses.coordinator.status}
              </span>
            </div>
            <div className="agent-card">
              <div className="agent-name">üìä DataAgent</div>
              <span className={`agent-status status-${agentStatuses.dataAgent.color}`}>
                {agentStatuses.dataAgent.status}
              </span>
            </div>
            <div className="agent-card">
              <div className="agent-name">‚öñÔ∏è DecisionAgent</div>
              <span className={`agent-status status-${agentStatuses.decisionAgent.color}`}>
                {agentStatuses.decisionAgent.status}
              </span>
            </div>
          </div>

          <div className="controls">
            <button 
              className="btn" 
              onClick={runConsensusSimulation}
              disabled={running}
            >
              {running ? 'Running...' : 'Run Consensus Cycle'}
            </button>
          </div>

          <div className="message-log">
            <h3>üì® Message Log (Last 20)</h3>
            <div className="log-list">
              {messages.length === 0 ? (
                <div style={{ color: '#999' }}>No messages yet. Click "Run Consensus Cycle" to start.</div>
              ) : (
                messages.map((msg, idx) => (
                  <div key={idx} className="log-entry">
                    <span className="log-tag">{msg.tag}</span> {msg.text}
                  </div>
                ))
              )}
            </div>
          </div>

          {policy && (
            <div className="policy-output">
              <h3>‚úÖ Policy Output</h3>
              <div className="policy-text">{policy}</div>
            </div>
          )}
        </div>
      );
    }

    ReactDOM.render(<ConsensusDashboard />, document.getElementById('root'));
  </script>
</body>
</html>